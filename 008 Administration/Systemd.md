## üîß –ì–¥–µ –¥–æ–ª–∂–Ω—ã –ª–µ–∂–∞—Ç—å systemd unit-—Ñ–∞–π–ª—ã?

### üìÅ `/etc/systemd/system/`

–≠—Ç–æ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —é–Ω–∏—Ç–æ–≤**, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –≤—Ä—É—á–Ω—É—é:

* –Æ–Ω–∏—Ç—ã –∑–¥–µ—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã **–≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ** (–≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º).
* –°–ª—É–∂–±—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è **–æ—Ç –∏–º–µ–Ω–∏ root** –∏–ª–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`User=...`).
* –≠—Ç–æ —Ç–æ –º–µ—Å—Ç–æ, –∫—É–¥–∞ systemd –æ–∂–∏–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–ª—É–∂–±—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–≤–æ–π `etl.service`).

> ‚úÖ –≠—Ç–æ **—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –º–µ—Å—Ç–æ**, –µ—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã —Å–ª—É–∂–±–∞ —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–ª–∏ –±—ã–ª–∞ —á–∞—Å—Ç—å—é —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–ª—É–∂–± (`systemctl start`, `enable`, `status` –∏ —Ç.–¥.)

---

### üìÅ `/etc/systemd/user/`

–≠—Ç–æ ‚Äî **–¥–ª—è user units**, —Ç.–µ. —Å–ª—É–∂–±, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è **–≤ —Ä–∞–º–∫–∞—Ö —Å–µ—Å—Å–∏–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**, –∞ –Ω–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–∏—Å—Ç–µ–º—ã.

* –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–µ —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–π `systemctl`, –∞ —á–µ—Ä–µ–∑ `systemctl --user`.
* –†–∞–±–æ—Ç–∞—é—Ç **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (–µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –∏–Ω–∞—á–µ).
* –ù–µ —Å—Ç–∞—Ä—Ç—É—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã, –µ—Å–ª–∏ –Ω–µ –≤–∫–ª—é—á—ë–Ω user lingering.

> ‚ö†Ô∏è –≠—Ç–æ **–Ω–µ —Ç–æ, —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ**, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã —Å–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–ª –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–∏—Å—Ç–µ–º—ã.

---

## üì¶ –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —é–Ω–∏—Ç—ã —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (PostgreSQL, ClickHouse –∏ —Ç.–ø.)?

### üìÅ `/usr/lib/systemd/system/`

* –°—é–¥–∞ —Å—Ç–∞–≤—è—Ç—Å—è **—é–Ω–∏—Ç—ã, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç—ã** (`rpm`, `deb` –∏ —Ç.–¥.).
* –ù–∞–ø—Ä–∏–º–µ—Ä:

  * PostgreSQL: `/usr/lib/systemd/system/postgresql.service`
  * ClickHouse: `/usr/lib/systemd/system/clickhouse-server.service`

> üìå **–ù–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –∏—Ö –ø—Ä—è–º–æ –∑–¥–µ—Å—å**, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å ‚Äî –ª—É—á—à–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ `/etc/systemd/system/` –∏ —Ç–∞–º –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å.

---

## üí° –ò—Ç–æ–≥–æ: –≥–¥–µ —Ç–≤–æ–π `etl.service` –¥–æ–ª–∂–µ–Ω –ª–µ–∂–∞—Ç—å?

**‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ:**

```bash
/etc/systemd/system/etl.service
```

* –î–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ.
* –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å–µ—Ä–≤–∏—Å.
* –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sudo systemctl start|stop|enable etl.service`.

---

–ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å–µ—Å—Å–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ, –±–µ–∑ root), —Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `~/.config/systemd/user/`, –Ω–æ —ç—Ç–æ —Å–æ–≤—Å–µ–º –¥—Ä—É–≥–∞—è –∏—Å—Ç–æ—Ä–∏—è.

---

## How to

1. üîç –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –≥–¥–µ –ª–µ–∂–∞—Ç systemd-—é–Ω–∏—Ç—ã.
2. üõ† –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π —é–Ω–∏—Ç (–±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è).
3. üìã –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —é–Ω–∏—Ç—ã.

---

## üîç 1. –ì–¥–µ –ª–µ–∂–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —é–Ω–∏—Ç?

–ù–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–π—Ç–∏ —é–Ω–∏—Ç `postgresql.service`:

```bash
systemctl status postgresql
```

–í —Å—Ç—Ä–æ–∫–µ `Loaded:` –±—É–¥–µ—Ç –Ω–∞–ø–∏—Å–∞–Ω–æ, –æ—Ç–∫—É–¥–∞ –∑–∞–≥—Ä—É–∂–µ–Ω —é–Ω–∏—Ç:

```text
Loaded: loaded (/usr/lib/systemd/system/postgresql.service; enabled; vendor preset: disabled)
```

---

## üõ† 2. –ö–∞–∫ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π —é–Ω–∏—Ç (–±–µ–∑ –ø—Ä—è–º–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å —é–Ω–∏—Ç PostgreSQL (–∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –∏–∑ `/usr/lib/systemd/system/`) ‚Äî –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –µ–≥–æ –ø—Ä—è–º–æ.

–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:

```bash
sudo systemctl edit postgresql
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç (–∏–ª–∏ –æ—Ç–∫—Ä–æ–µ—Ç) —Ñ–∞–π–ª-–æ–≤–µ—Ä–ª–µ–π:

```bash
/etc/systemd/system/postgresql.service.d/override.conf
```

–¢—ã –º–æ–∂–µ—à—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è. –ù–∞–ø—Ä–∏–º–µ—Ä:

```ini
[Service]
Environment="PGDATA=/custom/postgres/data"
```

–ü–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:

```bash
sudo systemctl daemon-reload
sudo systemctl restart postgresql
```

---

## üìã 3. –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —é–Ω–∏—Ç—ã

### –í—Å–µ —é–Ω–∏—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ systemd –∑–Ω–∞–µ—Ç:

```bash
systemctl list-unit-files
```

### –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:

```bash
systemctl list-units --type=service
```

### –ù–∞–π—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —é–Ω–∏—Ç:

```bash
systemctl list-units | grep etl
systemctl list-unit-files | grep postgres
```

---

## üìç –ì–¥–µ systemd –∏—â–µ—Ç —é–Ω–∏—Ç—ã (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)

```bash
/etc/systemd/system/               # –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —é–Ω–∏—Ç—ã
/run/systemd/system/              # –≤—Ä–µ–º–µ–Ω–Ω—ã–µ (–Ω–∞–ø—Ä. —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
/usr/lib/systemd/system/          # —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç–æ–º
```

–ò –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:

```bash
/etc/systemd/system/<service>.service.d/override.conf
```

---
